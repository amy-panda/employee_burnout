---
title: "Are your employees burning out?"
author: "Amy Yang"
date: "16/10/2021"
output:
  html_document:
    number_sections: no
    fig_caption: yes
    toc: yes
    toc_depth: '2'
  word_document:
    number_sections: no
    fig_caption: yes
    toc: yes
    toc_depth: '2'
  pdf_document:
    number_sections: no
    fig_caption: yes
    toc: yes
    toc_depth: '2'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This R Markdown file is to demonstrate the idea of Adjustment using the dataset of employee burnout rate from [Kaggle](https://www.kaggle.com/blurredmachine/are-your-employees-burning-out). As explained by Brian in [Regression Models for Data Science in R](https://leanpub.com/regmods/read#leanpub-auto-adjustment), adjustment describes how the third variable impact the relationship between another two in a linear model. 

## Data Tidying and Visualisation

```{r, message=FALSE, warning=FALSE}
# Load library
library(tidyverse)
library(corrplot)
library(janitor)

```

```{r, message=FALSE, warning=FALSE}
# Import csv file
e_burnout <- read_csv("employee_burn_out_rate.csv")
e_burnout <-clean_names(e_burnout)

```

```{r, message=FALSE, warning=FALSE}
# View the data structure
names(e_burnout)
glimpse(e_burnout)

```

There are 9 variables in the dataset including both categorical and numerical variables. Some variables are clarified as below.

-  Gender: Male or Female
-  Company Type: Service or Product
-  WFH Setup Available: Yes or No
-  Designation: The designation of the employee of work in the organization with range of [0.0,5.0]. Bigger value refers to higher designation.
-  Resource Allocation: The amount of resource allocated to employees to work,for example working hours, with range of [1.0,10.0]. Higer value means more resources.
-  Mental Fatigue Score: The level of fatigue mentally employees is facing, with range of [0.0,10.0], where 0.0 means no fatigue and 10.0 means completely fatigue.
-  Burn Rate: the rate of burnout while working with range of [0.0,10.0]. Higher value means more burn out. 


```{r, message=FALSE, warning=FALSE}
# convert the data format
e_burnout$date_of_joining <- as.Date(e_burnout$date_of_joining,"%d/%m/%Y")

```


```{r, message=FALSE, warning=FALSE}
# Check missing values and drop rows with na
cbind(
  lapply(
    lapply(e_burnout, is.na),sum)
)
e_burnout_clean <- drop_na(e_burnout)

```

To visualise the correlation matrix with `corrplot()`, the following categorical variables are assigned to be 0 or 1.

-  Gender: Female is 1 and Male is 0
-  Company Type: Service is 1 and Product is 0
-  WFH Setup Available: Yes is 1 and No is 0

Also, the variable *countdays* is calculated as the time period (days) between today's date and employee's joining date. 

```{r, message=FALSE, warning=FALSE}

# Transform the categorical variables and date variable
e_burnout_num <- 
  e_burnout_clean %>% 
  mutate(
        countdays=as.numeric(as.difftime(Sys.Date()-date_of_joining)),
        isfemale=ifelse(gender=="Female",1,0),
        isservice=ifelse(company_type=="Service",1,0),
        iswfh=ifelse(wfh_setup_available=="Yes",1,0)
         )
glimpse(e_burnout_num)

```

```{r, message=FALSE, warning=FALSE}

# Correlation
e_burnout_sub <- 
  e_burnout_num %>% 
  select(isfemale,isservice,iswfh,countdays,designation,resource_allocation,mental_fatigue_score,burn_rate)
corr_burnout <- cor(e_burnout_sub)
corrplot(corr_burnout, type = "upper", tl.col = "darkblue", tl.srt = 45,
         addCoef.col = "darkorange")

```

As shown in the correlation matrix, employee burnout rate was strongly associated with the level of mental fatigue, allocated resources and the position within the organisation. Among the remaining 4 variables, the availability for work from home setup had the most positive impact on reducing the burnout for employees.

## Adjustment


```{r}
# Model with work from home(wfh) setup availability and visualise the model
lm_w <- lm(burn_rate ~ iswfh, data = e_burnout_num)
summary(lm_w)
e_burnout_wfh <- e_burnout_num %>% filter(iswfh==1)
e_burnout_notwfh <- e_burnout_num %>% filter(iswfh==0)
ggplot(e_burnout_num,aes(x=as.factor(iswfh),y=burn_rate))+
  geom_point(aes(color=wfh_setup_available))+
  geom_hline(yintercept = mean(e_burnout_wfh$burn_rate), color = "aquamarine2", lwd = 1, lty = 2) +
  geom_hline(yintercept = mean(e_burnout_notwfh$burn_rate), color = "pink", lwd = 1, lty = 2)+
  labs(x="Whether work from home facility is available", y="Employee burnout rate",color="WFH setup available")+
  theme_bw()

```


```{r}
# Model with mental fatigue score
lm_m <- lm(burn_rate ~ mental_fatigue_score, data = e_burnout_num)
summary(lm_m)

# Model with mental fatigue score and wfh setup availability
lm_mw <- lm(burn_rate ~ mental_fatigue_score+iswfh, data = e_burnout_num)
summary(lm_mw)

# Visualise the adjustment by adding the variable mental fatigue score
ggplot(e_burnout_num,aes(mental_fatigue_score,burn_rate))+
  geom_point(aes(color=wfh_setup_available))+
  geom_hline(yintercept = mean(e_burnout_wfh$burn_rate), color = "aquamarine2", lwd = 1, lty = 2) +
  geom_hline(yintercept = mean(e_burnout_notwfh$burn_rate), color = "pink", lwd = 1, lty = 2)+
  geom_abline(intercept = coef(lm_mw)[1]+coef(lm_mw)[3], slope = coef(lm_mw)[2], color = "aquamarine2", lwd = 1.5) +
  geom_abline(intercept = coef(lm_mw)[1], slope = coef(lm_mw)[2], color = "pink", lwd = 1.5) +
  geom_abline(intercept = coef(lm_m)[1], slope = coef(lm_m)[2])+
  labs(x="Mental Fatigue Score",y="Employee burnout rate",color="WFH setup available")+
  theme_bw()

```

```{r}
# Model with resource allocation
lm_r <- lm(burn_rate ~ resource_allocation, data = e_burnout_num)
summary(lm_r)

# Model with resource allocation and wfh setup availability
lm_rw <- lm(burn_rate ~ resource_allocation+iswfh, data = e_burnout_num)
summary(lm_rw)

# Visualise the adjustment by adding the variable resource allocation
ggplot(e_burnout_num,aes(resource_allocation,burn_rate))+
  geom_point(aes(color=wfh_setup_available))+
  geom_hline(yintercept = mean(e_burnout_wfh$burn_rate), color = "aquamarine2", lwd = 1, lty = 2) +
  geom_hline(yintercept = mean(e_burnout_notwfh$burn_rate), color = "pink", lwd = 1, lty = 2)+
  geom_abline(intercept = coef(lm_rw)[1]+coef(lm_rw)[3], slope = coef(lm_rw)[2], color = "aquamarine2", lwd = 1.5) +
  geom_abline(intercept = coef(lm_rw)[1], slope = coef(lm_rw)[2], color = "pink", lwd = 1.5) +
  geom_abline(intercept = coef(lm_r)[1], slope = coef(lm_r)[2])+
  labs(x="Resource allocation",y="Employee burnout rate",color="WFH setup available")+
  theme_bw()

```

```{r}
#Model with designation
lm_d <- lm(burn_rate ~ designation, data = e_burnout_num)
summary(lm_d)

# Model with designation and wfh setup availability
lm_dw <- lm(burn_rate ~ designation+iswfh, data = e_burnout_num)
summary(lm_dw)

# Visualise the adjustment by adding the variable designation
ggplot(e_burnout_num,aes(designation,burn_rate))+
  geom_point(aes(color=wfh_setup_available))+
  geom_hline(yintercept = mean(e_burnout_wfh$burn_rate), color = "aquamarine2", lwd = 1, lty = 2) +
  geom_hline(yintercept = mean(e_burnout_notwfh$burn_rate), color = "pink", lwd = 1, lty = 2)+
  geom_abline(intercept = coef(lm_dw)[1]+coef(lm_dw)[3], slope = coef(lm_dw)[2], color = "aquamarine2", lwd = 1.5) +
  geom_abline(intercept = coef(lm_dw)[1], slope = coef(lm_dw)[2], color = "pink", lwd = 1.5) +
  geom_abline(intercept = coef(lm_d)[1], slope = coef(lm_d)[2])+
  labs(x="Designation",y="Employee burnout rate",color="WFH setup available")+
  theme_bw()

```






